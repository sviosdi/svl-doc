<!doctype html>
<html lang="fr" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-signaux&slots/Signaux&Slots">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Signaux &amp; Slots | SavvyLite</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://sviosdi.github.io/svl-doc/docs/signaux&amp;slots/"><meta data-rh="true" name="docusaurus_locale" content="fr"><meta data-rh="true" name="docsearch:language" content="fr"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Signaux &amp; Slots | SavvyLite"><meta data-rh="true" name="description" content="Signaux &amp; Slots"><meta data-rh="true" property="og:description" content="Signaux &amp; Slots"><meta data-rh="true" name="keywords" content="signal,slot,signaux,slots"><link data-rh="true" rel="icon" href="/svl-doc/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://sviosdi.github.io/svl-doc/docs/signaux&amp;slots/"><link data-rh="true" rel="alternate" href="https://sviosdi.github.io/svl-doc/docs/signaux&amp;slots/" hreflang="fr"><link data-rh="true" rel="alternate" href="https://sviosdi.github.io/svl-doc/docs/signaux&amp;slots/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/svl-doc/blog/rss.xml" title="SavvyLite RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/svl-doc/blog/atom.xml" title="SavvyLite Atom Feed"><link rel="stylesheet" href="/svl-doc/assets/css/styles.447d7bb8.css">
<link rel="preload" href="/svl-doc/assets/js/runtime~main.10013e08.js" as="script">
<link rel="preload" href="/svl-doc/assets/js/main.ed95f9d1.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div role="region" aria-label="Aller au contenu principal"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Aller au contenu principal</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/svl-doc/"><div class="navbar__logo"><img src="/svl-doc/img/logo_svl.svg" alt="SavvyLiteLogo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/svl-doc/img/logo_svl.svg" alt="SavvyLiteLogo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">SavvyLite</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/svl-doc/docs/intro">Documentation</a><a class="navbar__item navbar__link" href="/svl-doc/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://gitlab.com/savvylite" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/svl-doc/docs/intro">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/svl-doc/docs/category/signaux--slots">Signaux &amp; Slots</a><button aria-label="Plier/Déplier la catégorie &#x27;Signaux &amp; Slots&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/svl-doc/docs/signaux&amp;slots/Signaux">Signal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item dev-icon"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/svl-doc/docs/signaux&amp;slots/">Signaux &amp; Slots</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/svl-doc/docs/category/litejson">liteJSON</a><button aria-label="Plier/Déplier la catégorie &#x27;liteJSON&#x27; de la barre latérale" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d&#x27;Ariane"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Page d&#x27;accueil" class="breadcrumbs__link" href="/svl-doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/svl-doc/docs/category/signaux--slots"><span itemprop="name">Signaux &amp; Slots</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Signaux &amp; Slots</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><h1>Signaux &amp; slots <span style="position:relative;bottom:0.3rem;background:#d8f7df;border:solid 1px #b8d7bf;border-radius:0.2rem;color:#666;padding:0.15rem 0.35rem;margin-left:0.5rem;font-size:0.9rem;font-weight:400">dev</span></h1><p>#include <a href="https://gitlab.com/sviosdi/signals_slots/-/blob/main/include/Signal.hpp" target="_blank" rel="noopener noreferrer">&quot;Signal.hpp&quot;</a><br>
#include <a href="https://gitlab.com/sviosdi/signals_slots/-/blob/main/include/Slot.hpp" target="_blank" rel="noopener noreferrer">&quot;Slot.hpp&quot;</a></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="quel-type-pour-représenter-un-slot-">Quel type pour représenter un slot ?<a class="hash-link" href="#quel-type-pour-représenter-un-slot-" title="Lien direct vers le titre">​</a></h2><p>Les classes <code>Signal</code> et <code>Slot</code> sont des patrons de classe dont les paramètres sont une liste variable correspondant aux paramètres du signal.
La classe Signal dérive de la classe <code>SaSSignal</code> qui n&#x27;est pas un patron de classe. (On expliquera pourquoi plus loin.)</p><p>Chaque signal contient un conteneur (à déterminer) <code>connectedSlots</code> des slots de type <code>&lt;Slot&lt;Params...&gt;</code> qui lui sont connectés. A l&#x27;émission du signal par l&#x27;opérateur
<code>Signal::operator()(Params...)</code>, tous les slots du conteneur <code>connectedSlots</code> sont exécutés par l&#x27;opérateur : <code>Slot::operator()(Params...)</code>.</p><p>Seuls les paramètres d&#x27;un signal donné déterminent les fonctions ou méthodes auxquelles il peut être connecté. Le conteneur <code>connectedSlots</code> aura donc pour contrainte de
devoir stocker des objets qui représentent les slots de type <code>&lt;Slot&lt;Params...&gt;</code>. Or ceux-ci, même s&#x27;ils ont en commun le type de leur paramètres, peuvent être très différents par le
fait qu&#x27;ils soient des fonctions ou des méthodes, et s&#x27;ils sont des méthodes d&#x27;un objet, cet objet peut être l&#x27;instance de classes différentes. Le type des valeurs de
retour peuvent aussi différer.</p><p>Notre type <code>Slot&lt;Params...&gt;</code> doit pouvoir représenter ces slots finalement très différents, qui n&#x27;ont que le type de leurs paramètres en commun, conforme à ceux du
signal. Pour rendre ceci possible, un slot doit donc perdre lors de sa création le fait d&#x27;être une fonction ou une méthode. Il doit aussi oublier la signature de
la fonction ou de la méthode, le type de la valeur de retour et oublier le type de l&#x27;objet connecté. Mais il faudra pouvoir retrouver toutes ses caractéristiques
de type <em>[fonction | méthode]<!-- -->/signature/objet connecté</em> lors de l&#x27;exécution du slot.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="anonymiser-lobjet-à-connecter">Anonymiser l&#x27;objet à connecter<a class="hash-link" href="#anonymiser-lobjet-à-connecter" title="Lien direct vers le titre">​</a></h2><p>La classe <code>Slot</code> dispose d&#x27;un constructeur de <em>slot pour méthode</em> ou d&#x27;un constructeur de <em>slot pour fonction</em>. Leur rôle étant d&#x27;enregistrer les pointeurs vers
l&#x27;<em>objet&amp;méthode</em> ou vers la <em>fonction</em> de manière <em>anonymisée</em> (anonymiser = rendre anonyme de manière réversible), en leur faisant perdre leur type pour devenir
des pointeurs <code>void*</code> ou <code>char*</code>. Dans le cas d&#x27;un <em>slot méthode</em>, on pourrait enregister de manière anonymisé l&#x27;objet connecté en enregistrant son adresse convertie
en <code>void*</code> dans un membre <code>obj_anonyme</code>. (qui prendrait la valeur <code>nullptr</code> dans le cas d&#x27;un <em>slot fonction</em>.)</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> obj_anonyme</span><span class="token punctuation" style="color:#666">{</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">void</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">obj_appele</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">;</span><span class="token plain">             </span><span class="token comment" style="color:#008000;font-style:italic">// anonymisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">OBJ_APPELE</span><span class="token operator" style="color:#444">*</span><span class="token plain"> ptr_obj</span><span class="token punctuation" style="color:#666">{</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name" style="color:#00677c">OBJ_APPELE</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">obj_anonyme</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">;</span><span class="token plain">    </span><span class="token comment" style="color:#008000;font-style:italic">// désanonymisation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">(</span><span class="token operator" style="color:#444">*</span><span class="token plain">ptr_obj</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">.</span><span class="token function" style="color:#00677c">methode</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token plain">    </span><span class="token comment" style="color:#008000;font-style:italic">// ok - méthode utilisable  ptr_obj == obj_appele</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">ptr_obj</span><span class="token operator" style="color:#444">-&gt;</span><span class="token function" style="color:#00677c">methode</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token plain">      </span><span class="token comment" style="color:#008000;font-style:italic">// ok</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="anonymiser-la-méthode-à-connecter">Anonymiser la méthode à connecter<a class="hash-link" href="#anonymiser-la-méthode-à-connecter" title="Lien direct vers le titre">​</a></h2><p>Pour ce qui est d&#x27;enregistrer une fonction | méthode, c&#x27;est moins simple. Pour bien comprendre ce qu&#x27;il va falloir faire, observons l&#x27;exemple suivant d&#x27;une classe <code>A</code> disposant
d&#x27;une méthode <code>A::meth(int)</code>. Le code suivant fonctionne alors correctement :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token plain">A a</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token comment" style="color:#008000;font-style:italic">// PM = type &quot;pointeur vers une méthode de A&quot; (retournant void et de paramètre int).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token keyword" style="color:#092e64">using</span><span class="token plain"> PM </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">void</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">A</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token operator" style="color:#444">*</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">int</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token comment" style="color:#008000;font-style:italic">// la variable m contient l&#x27;adresse de la méthode meth,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token comment" style="color:#008000;font-style:italic">// pm est un pointeur vers A::meth(int)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">PM pm </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token operator" style="color:#444">&amp;</span><span class="token plain">A</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">meth</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token comment" style="color:#008000;font-style:italic">// appel de la méthode en déréférençant le pointeur de méthode.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#666">.</span><span class="token operator" style="color:#444">*</span><span class="token plain">pm</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token number" style="color:#000080">7</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On pourrait être tenté, comme pour l&#x27;objet, de convertir le pointeur de méthode en void<!-- -->*<!-- --> :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> m_an </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">void</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">pm</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token comment" style="color:#008000;font-style:italic">//Non!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">     </span><span class="token comment" style="color:#008000;font-style:italic">// conversion d&#x27;un pointeur de fonction en void* non autorisée en C++</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Mais C++ n&#x27;autorise pas la conversion d&#x27;un pointeur de fonction en pointeur de void. Il va falloir donc passer par un pointeur vers le pointeur de méthode :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#982e64"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> m_an </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">void</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain">pm</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#982e64"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">PM pm </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token operator" style="color:#444">*</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name" style="color:#00677c">PM</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">m_an</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain">    </span><span class="token comment" style="color:#008000;font-style:italic">// using PM = void(A::*)(int);</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#982e64"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#666">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#666">.</span><span class="token operator" style="color:#444">*</span><span class="token plain">pm</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token number" style="color:#000080">12</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On obtient donc l&#x27;enchaînement suivant de déréférencements de pointeurs: <code>m_an → m → A::meth</code>.</p><ol><li><p><code>m_an</code> devient un pointeur &quot;anonymisé&quot; vers le pointeur <code>pm</code>. Il pointe vers la zone mémoire contenant <code>pm</code> qui pointe à son tour vers la méthode. Mais <code>pm</code> est
interprété en pointeur de void et non plus en pointeur de méthode.</p></li><li><p>ici on désanonymise le pointeur vers pm. Il n&#x27;est plus un pointeur vers void mais un pointeur de PM autrement dit un pointeur vers un pointeur de méthode.
Une fois déréférencé, pm devient bien un pointeur de méthode.</p></li><li><p>appel de la méthode, après déréférencement du pointeur de méthode.</p></li></ol><p>Étudions le cas du constructeur d&#x27;un <em>slot Methode</em>. On notera <code>RT</code> le type de la valeur retournée, <code>OBJ_APPELE</code> le type de l&#x27;objet connectée et <code>PARAMS...</code>
représente le type des paramètres. Il faut passer comme paramètres du constructeur un pointeur vers l&#x27;objet connecté et un pointeur vers la méthode de cet objet:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token plain">OBJ_APPELE</span><span class="token operator" style="color:#444">*</span><span class="token plain"> obj_appele</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token function" style="color:#00677c">RT</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">OBJ_APPELE</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token operator" style="color:#444">*</span><span class="token plain">methode</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On a vu précédemment que l&#x27;anonymisation du pointeur de l&#x27;objet appelé dans le membre <code>obj_anonyme</code> se fait par à l&#x27;initialisation par :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token plain">obj_anonyme</span><span class="token punctuation" style="color:#666">{</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">void</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">obj_appele</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Maintenant en prenant un pointeur vers le pointeur de méthode, on devrait pouvoir être tenté à nouveau de le convertir en <code>void*</code> par :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> ptr_methode</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">ptr_methode</span><span class="token punctuation" style="color:#666">{</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">void</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain">pm</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>où <code>ptr_methode</code> serait un membre de Slot de type <code>void*</code>.
Et effectivement on pourrait dans le constructeur désanonymiser la méthode et effectuer (dans le cas où par exemple la méthode a pour paramètre un <code>int</code>)
son appel par le code suivant :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">using</span><span class="token plain"> PM </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token function" style="color:#00677c">RT</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">OBJ_APPELE</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token operator" style="color:#444">*</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">PM pm </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token operator" style="color:#444">*</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name" style="color:#00677c">PM</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">ptr_methode</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">(</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name" style="color:#00677c">OBJ_APPELE</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">obj_anonyme</span><span class="token punctuation" style="color:#666">)</span><span class="token operator" style="color:#444">-&gt;</span><span class="token operator" style="color:#444">*</span><span class="token plain">pm</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token number" style="color:#000080">84</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"> </span><span class="token comment" style="color:#008000;font-style:italic">// OK seulement dans le constructeur</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>attention</div><div class="admonitionContent_S0QG"><p>Et pourtant ce code qui devrait s&#x27;exécuter dans un constructeur de <code>Slot</code> ne marcherait pas en dehors du constructeur. Mais pourquoi donc ?</p></div></div><p>Car l&#x27;enregistrement par : <code>ptr_methode{reinterpret_cast&lt;void*&gt;(&amp;pm)}</code> n&#x27;est pas correct. On a en effet cet enchaînement de pointeurs:
<code>ptr_methode → pm → OBJ_APPELE::methode</code><br></p><p><img loading="lazy" alt="pb de variable locale" src="/svl-doc/assets/images/sas-4d47babeb53d8d787c02edf312c2a457.png" width="663" height="314" class="img_ev3q"></p><p>Si à ce stade l&#x27;emplacement mémoire occupé par <code>pm</code> pointe correctement vers la méthode de l&#x27;objet, cet emplacement mémoire n&#x27;est qu&#x27;une <strong>variable locale</strong>
passée en paramètre au constructeur. Et par conséquent à la sortie du constructeur, le contenu de cet emplacement est perdu, or c&#x27;est vers lui que pointe
<code>ptr_methode</code>, qui devient un pointeur vers une zone qui ne contient plus le pointeur vers la méthode de l&#x27;objet!<br> La solution est donc d&#x27;allouer un
espace mémoire <code>char*</code> pour <code>ptr_methode</code> et d&#x27;y recopier octet par octet le contenu de l&#x27;emplacement mémoire occupé par la variable <code>pm</code>.<br></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>attention</div><div class="admonitionContent_S0QG"><p>L&#x27;espace à allouer à <code>ptr_methode</code> est <code>sizeof(PM)</code>, autrement dit la taille d&#x27;un pointeur de méthode. On supposera que cette taille est fixe, indépendante de
la classe ou encore de la signature de la méthode.</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">constexpr</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">short</span><span class="token plain">  PTR_METH_SIZE </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token number" style="color:#000080">16</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Avant d&#x27;utiliser la classe Signal, il est nécessaire d&#x27;effecter les tests sur la plateforme cible et d&#x27;ajuster cette valeur si nécessaire.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="rôle-de-la-classe-slotkey">Rôle de la classe <code>SlotKey</code><a class="hash-link" href="#rôle-de-la-classe-slotkey" title="Lien direct vers le titre">​</a></h2><p>Revenons à la classe Signal. Pour synthétiser, on sait que chaque signal contient un conteneur <code>connectedSlots</code> des Slots qui lui sont connectés et que l&#x27;exécution
du signal aura pour effect d&#x27;appeler et d&#x27;exécuter chacun des slots connectés. Lors de la connexion d&#x27;un slot il faut ajouter le slot au conteneur
de slots mais il faudra aussi vérifier que le slot n&#x27;est pas déjà connecté (déjà existant dans <code>connectedSlots</code>) sans quoi le slot risque de s&#x27;exécuter plusieurs
fois à l&#x27;émission du signal. Il faudra aussi pouvoir retrouver rapidement un slot dans le conteneur pour le retirer lors d&#x27;une déconnexion. On voit apparaître ici
la nécessité de pouvoir <em>comparer</em> des slots, au moins en égalité. Si on peut en plus leur associer une relation d&#x27;ordre on pourra alors plus rapidement accéder à un slot.
Avec une relation d&#x27;ordre appropriée sur les slots on pourra utiliser un <code>map</code> qui associera une fonction/méthode connectée au Slot qui lui correspond. C&#x27;est là qu&#x27;intervient
la classe <code>SlotKey</code>. Tout commence au niveau de la connexion :</p><ul><li>la fonction | objet&amp;méthode passés lors de la connexion serviront à construire le <code>SlotKey</code> correspondant dont le rôle sera de les enregistrer en les anonymisant.</li><li>Ce <code>SlotKey</code> ainsi créé servira de clé dans le <code>map</code> avec pour valeur associée un <code>Slot</code> dont le rôle sera de pouvoir désanonymiser le slot et de pouvoir effectuer son appel.</li></ul><p>La classe <code>SlotKey</code> contient les membres:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> obj_anonyme</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token keyword" style="color:#092e64">union</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token keyword" style="color:#092e64">char</span><span class="token operator" style="color:#444">*</span><span class="token plain"> ptr_methode</span><span class="token punctuation" style="color:#666">{</span><span class="token keyword" style="color:#092e64">nullptr</span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token keyword" style="color:#092e64">const</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> ptr_function</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Et en plus du constructeur par défaut qui initialise ces membres à <code>nullptr</code>, il y a deux constructeurs selon qu&#x27;on connecte une fonction ou une méthode:</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token function" style="color:#00677c">SlotKey</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">char</span><span class="token operator" style="color:#444">*</span><span class="token plain"> meth</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token operator" style="color:#444">:</span><span class="token plain"> obj_anonyme</span><span class="token punctuation" style="color:#666">{</span><span class="token plain">obj</span><span class="token punctuation" style="color:#666">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token keyword" style="color:#092e64">char</span><span class="token operator" style="color:#444">*</span><span class="token plain"> tmp </span><span class="token operator" style="color:#444">=</span><span class="token plain"> meth</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  ptr_methode </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">new</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">char</span><span class="token punctuation" style="color:#666">[</span><span class="token plain">PTR_METH_SIZE</span><span class="token punctuation" style="color:#666">]</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token keyword" style="color:#092e64">for</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">int</span><span class="token plain"> i </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token number" style="color:#000080">0</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"> i </span><span class="token operator" style="color:#444">&lt;</span><span class="token plain"> PTR_METH_SIZE</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"> i</span><span class="token operator" style="color:#444">++</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    ptr_methode</span><span class="token punctuation" style="color:#666">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#666">]</span><span class="token plain"> </span><span class="token operator" style="color:#444">=</span><span class="token plain"> tmp</span><span class="token punctuation" style="color:#666">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#666">]</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token function" style="color:#00677c">SlotKey</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> func</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token operator" style="color:#444">:</span><span class="token plain"> obj_anonyme</span><span class="token punctuation" style="color:#666">{</span><span class="token keyword" style="color:#092e64">nullptr</span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> ptr_function</span><span class="token punctuation" style="color:#666">{</span><span class="token plain">func</span><span class="token punctuation" style="color:#666">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pour comparer les <code>SlotKeys</code> on comparera directement les adresses de leurs membres. Si <code>obj_anonyme == nullptr</code> il s&#x27;agira d&#x27;un <code>SlotKeys</code> <em>fonction</em>, sinon c&#x27;est un <code>SlotKeys</code> <em>méthode</em>.
La relation d&#x27;ordre sera définie ainsi:</p><ul><li>S&#x27;il s&#x27;agit de deux <code>SlotKeys</code> <em>fonction</em> : on compare directement leurs adresses.</li><li>S&#x27;il s&#x27;agit d&#x27;un <code>SlotKeys</code> <em>fonction</em> et d&#x27;un <code>SlotKeys</code> <em>méthode</em> : on considéra que <code>SlotKeys</code> <em>fonction</em> &lt; <code>SlotKeys</code> <em>méthode</em>.</li><li>S&#x27;il s&#x27;agit de deux <code>SlotKeys</code> <em>méthode</em> : il seront dans l&#x27;ordre des objets <code>obj_anonyme</code> si ceux-ci sont différents, et s&#x27;il sont égaux
ils seront dans l&#x27;ordre des méthodes <code>ptr_methode</code>. Mais dans ce dernier cas, on fera attention à ne pas comparer directement les valeurs de <code>ptr_methode</code>, mais les valeurs
vers lesquelles elles pointent en les déréférençant.</li></ul><p>On fournira à la classe SlotKey un constructeur par copie, un destructeur et fournira les opérateurs <code>friend</code> de comparaison, nécessaires pour l&#x27;utilisation du <code>map</code>.
On peut maintenant définir notre conteneur de slots dans la classe <code>Signal</code> :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">map</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">SlotKey</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> Slot</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token operator" style="color:#444">&gt;&gt;</span><span class="token plain"> connectedSlots</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Il reste à étudier maintenant comment est construit un slot et comment s&#x27;effectue son appel.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="construction-des-slots">Construction des slots<a class="hash-link" href="#construction-des-slots" title="Lien direct vers le titre">​</a></h2><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">template</span><span class="token operator" style="color:#444">&lt;</span><span class="token keyword" style="color:#092e64">typename</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token plain"> Params</span><span class="token operator" style="color:#444">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token keyword" style="color:#092e64">class</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">Slot</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token keyword" style="color:#092e64">public</span><span class="token operator" style="color:#444">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token function" style="color:#00677c">Slot</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token function" style="color:#00677c">Slot</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">void</span><span class="token punctuation" style="color:#666">(</span><span class="token operator" style="color:#444">*</span><span class="token plain">fct_appel</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">const</span><span class="token plain"> SlotKey</span><span class="token operator" style="color:#444">&amp;</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token operator" style="color:#444">:</span><span class="token plain"> appel</span><span class="token punctuation" style="color:#666">{</span><span class="token plain">fct_appel</span><span class="token punctuation" style="color:#666">}</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">operator</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">const</span><span class="token plain"> SlotKey</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain"> key</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token plain"> params</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        </span><span class="token function" style="color:#00677c">appel</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">bool</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">operator</span><span class="token operator" style="color:#444">!=</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">const</span><span class="token plain"> Slot</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain"> other</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        </span><span class="token keyword" style="color:#092e64">return</span><span class="token plain"> appel </span><span class="token operator" style="color:#444">!=</span><span class="token plain"> other</span><span class="token punctuation" style="color:#666">.</span><span class="token plain">appel</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token operator" style="color:#444">*</span><span class="token plain">appel</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">const</span><span class="token plain"> SlotKey</span><span class="token operator" style="color:#444">&amp;</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Comme expliqué auparavant, le patron de la classe <code>Slot</code> ne doit dépendre que du type des paramètres. Les autres types nécessaires <code>RT</code> et <code>OBJ_APPELE</code> ne devant pas
intervenir dans cette classe. Le constructeur de <code>Slot</code> reçoit en paramètre et l&#x27;enregistre un pointeur vers une fonction<code> appel(...)</code> qui est une fonction <code>static</code> d&#x27;une sous classe,
cette dernière pouvant faire intervenir les autres types. Cette fonction par l&#x27;intermédiaire des paramètres qu&#x27;elle reçoit à l&#x27;exécution du <code>Slot</code> sera capable de
désanonymiser le slot et d&#x27;effectuer son appel. Observons le cas d&#x27;un <em>slot méthode</em> :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">template</span><span class="token operator" style="color:#444">&lt;</span><span class="token keyword" style="color:#092e64">typename</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">OBJ_APPELE</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">typename</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">RT</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">typename</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token plain"> Params</span><span class="token operator" style="color:#444">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token keyword" style="color:#092e64">class</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">SlotMethode</span><span class="token plain"> </span><span class="token operator" style="color:#444">:</span><span class="token plain"> </span><span class="token base-clause keyword" style="color:#092e64">public</span><span class="token base-clause"> </span><span class="token base-clause class-name" style="color:#00677c">Slot</span><span class="token base-clause operator" style="color:#444">&lt;</span><span class="token base-clause class-name" style="color:#00677c">Params</span><span class="token base-clause punctuation" style="color:#666">.</span><span class="token base-clause punctuation" style="color:#666">.</span><span class="token base-clause punctuation" style="color:#666">.</span><span class="token base-clause operator" style="color:#444">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token keyword" style="color:#092e64">public</span><span class="token operator" style="color:#444">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token function" style="color:#00677c">SlotMethode</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token operator" style="color:#444">:</span><span class="token plain"> </span><span class="token generic-function function" style="color:#00677c">Slot</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name" style="color:#00677c">Params</span><span class="token generic-function generic class-name punctuation" style="color:#666">.</span><span class="token generic-function generic class-name punctuation" style="color:#666">.</span><span class="token generic-function generic class-name punctuation" style="color:#666">.</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain">appel</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">static</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token function" style="color:#00677c">appel</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">const</span><span class="token plain"> SlotKey</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain"> key</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token plain"> params</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        </span><span class="token keyword" style="color:#092e64">using</span><span class="token plain"> TYPE_PTR_METHODE </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token function" style="color:#00677c">RT</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">OBJ_APPELE</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token operator" style="color:#444">*</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token plain"> params</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        OBJ_APPELE</span><span class="token operator" style="color:#444">*</span><span class="token plain"> objet_appele  </span><span class="token operator" style="color:#444">=</span><span class="token plain">   </span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name" style="color:#00677c">OBJ_APPELE</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">.</span><span class="token plain">obj_anonyme</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        TYPE_PTR_METHODE methode  </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token operator" style="color:#444">*</span><span class="token punctuation" style="color:#666">(</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name" style="color:#00677c">TYPE_PTR_METHODE</span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">.</span><span class="token plain">ptr_methode</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">objet_appele</span><span class="token operator" style="color:#444">-&gt;</span><span class="token operator" style="color:#444">*</span><span class="token plain">methode</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Le constructeur n&#x27;a pas de paramètre, mais il passe à la classe de base <code>Slot</code> le pointeur vers sa fonction <code>static</code> <code>appel(...</code>). Lorsque le slot est
appelé, cette fonction est exécutée, et comme son premier paramètre est un <code>SlotKey</code> qui comporte en lui toutes les données anonymisées nécessaires
pour retrouver le type du slot, il peut le désanonymiser puis utiliser les paramètres passés par le second paramètre pour effectuer l&#x27;appel définitif de la méthode
désanonymisée sur l&#x27;objet désanonymisé.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="exécution-des-slots">Exécution des slots<a class="hash-link" href="#exécution-des-slots" title="Lien direct vers le titre">​</a></h2><p>La magie opère : nos <code>SlotKey</code>s ont tous le même type, nos <code>Slot</code>s ont tous le même type, on peut ainsi mapper l&#x27;un à l&#x27;autre dans un
<code>std::map&lt;SlotKey, Slot&lt;Params...&gt;&gt;</code> et à l&#x27;émission du signal il suffira de parcourir les valeurs du <code>map</code> pour effectuer tous les appels nécessaires :
c&#x27;est le rôle de l&#x27;opérateur <code>()</code> de la classe Signal :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">operator</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token plain"> params</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">for</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">auto</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:#666">]</span><span class="token plain"> </span><span class="token operator" style="color:#444">:</span><span class="token plain"> connectedSlots</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        Slot</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token operator" style="color:#444">&gt;</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain"> slot </span><span class="token operator" style="color:#444">=</span><span class="token plain"> value</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        </span><span class="token function" style="color:#00677c">slot</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="сonnexion-dun-signal-à-une-méthode">Сonnexion d&#x27;un signal à une méthode<a class="hash-link" href="#сonnexion-dun-signal-à-une-méthode" title="Lien direct vers le titre">​</a></h2><p>Observons maintenant plus précisément le fonctionnement d&#x27;une connexion d&#x27;un signal à une méthode :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token plain"> </span><span class="token keyword" style="color:#092e64">template</span><span class="token plain"> </span><span class="token operator" style="color:#444">&lt;</span><span class="token keyword" style="color:#092e64">typename</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">OBJ_APPELE</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">typename</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">RT</span><span class="token operator" style="color:#444">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token function" style="color:#00677c">connect</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">OBJ_APPELE </span><span class="token operator" style="color:#444">*</span><span class="token plain">obj_appele</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> </span><span class="token function" style="color:#00677c">RT</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">OBJ_APPELE</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token operator" style="color:#444">*</span><span class="token plain">methode</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    SlotKey </span><span class="token function" style="color:#00677c">key</span><span class="token punctuation" style="color:#666">(</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">void</span><span class="token generic-function generic class-name" style="color:#00677c"> </span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">obj_appele</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">                </span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">char</span><span class="token generic-function generic class-name" style="color:#00677c"> </span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain">methode</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">connectedSlots</span><span class="token punctuation" style="color:#666">.</span><span class="token function" style="color:#00677c">count</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      </span><span class="token keyword" style="color:#092e64">return</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    SlotMethode</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">OBJ_APPELE</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> RT</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token operator" style="color:#444">&gt;</span><span class="token plain"> slot</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">is_base_of</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">Object</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> OBJ_APPELE</span><span class="token operator" style="color:#444">&gt;</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">value</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      </span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Object </span><span class="token operator" style="color:#444">*</span><span class="token punctuation" style="color:#666">)</span><span class="token plain">obj_appele</span><span class="token punctuation" style="color:#666">)</span><span class="token operator" style="color:#444">-&gt;</span><span class="token function" style="color:#00677c">addSignal</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">this</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      slot</span><span class="token punctuation" style="color:#666">.</span><span class="token plain">isObject </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token boolean" style="color:#808000">true</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    connectedSlots</span><span class="token punctuation" style="color:#666">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">]</span><span class="token plain"> </span><span class="token operator" style="color:#444">=</span><span class="token plain"> slot</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token punctuation" style="color:#666">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Imaginons la connexion d&#x27;un objet <code>a</code> , instance d&#x27;une classe <code>A</code> , à une méthode <code>A::m(int, const char*)</code>.<br>
La connexion se fait ainsi : <code>a.connect(&amp;a, &amp;A::m)</code><br>
On voit apparaître les quatre étapes suivantes :</p><ol><li>Les types OBJ_APPELE, RT et Params sont déduits des paramètres passés à la connexion.</li><li>On crée un <code>SlotKey</code> qui va récupérer les données et les anonymiser. S&#x27;il est déjà présent, c&#x27;est que le signal à déjà été connecté
à ce slot, on ignore alors la connexion en retournant sans rien faire.</li><li>On construit un <code>SlotMethode</code> sans aucun argument : c&#x27;est une sorte de coquille vide, mais qui récupère tous les types
énoncés au point 1.</li><li>On teste ensuite si l&#x27;objet connecté est une instance d&#x27;une classe dérivée de la classe <code>svl::Object</code> et si c&#x27;est le cas, on ajoute le signal au
conteneur des signaux de l&#x27;objet par la méthode <code>Object::addSignal()</code> ce qui permettra, en cas de destruction de l&#x27;objet, de déconnecter <em>ce</em>
signal et de la même façon <em>tous</em> les signaux qui lui sont connectés. On marque ce slot comme étant un slot méthode d&#x27;un objet dérivant de la classe
<code>Object</code>.</li><li>On enregistre dans le signal (dans son map <code>connectedSlots</code>) la paire <code>SlotKey</code> ➞ <code>SlotMethode</code>. Et on peut le faire, car un
<code>SlotMethode</code> <strong>est un</strong> <code>Slot</code> et on n&#x27;a pas besoin d&#x27;avoir de pointeurs de slots ou de références de slots pour faire fonctionner
le polymorphisme, car la seule méthode utilisée dans les slots est l&#x27;operateur d&#x27;appel <code>()</code> qui est une méthode propre à la classe de base.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="déconnexion-dun-signal">Déconnexion d&#x27;un signal<a class="hash-link" href="#déconnexion-dun-signal" title="Lien direct vers le titre">​</a></h2><p>Prenons l&#x27;exemple d&#x27;une déconnexion d&#x27;une méthode : <code>a-&gt;disconnect(&amp;a, &amp;A:m)</code> <br>Pour une fonction c&#x27;est très similaire en plus simple.</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">template</span><span class="token plain"> </span><span class="token operator" style="color:#444">&lt;</span><span class="token keyword" style="color:#092e64">typename</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">OBJ_APPELE</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">typename</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">RT</span><span class="token operator" style="color:#444">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token function" style="color:#00677c">disconnect</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">OBJ_APPELE </span><span class="token operator" style="color:#444">*</span><span class="token plain">obj_appele</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">                  </span><span class="token function" style="color:#00677c">RT</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">OBJ_APPELE</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token operator" style="color:#444">*</span><span class="token plain">methode</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    SlotKey </span><span class="token function" style="color:#00677c">key</span><span class="token punctuation" style="color:#666">(</span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">void</span><span class="token generic-function generic class-name" style="color:#00677c"> </span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">obj_appele</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">                </span><span class="token generic-function function" style="color:#00677c">reinterpret_cast</span><span class="token generic-function generic class-name operator" style="color:#444">&lt;</span><span class="token generic-function generic class-name keyword" style="color:#092e64">char</span><span class="token generic-function generic class-name" style="color:#00677c"> </span><span class="token generic-function generic class-name operator" style="color:#444">*</span><span class="token generic-function generic class-name operator" style="color:#444">&gt;</span><span class="token punctuation" style="color:#666">(</span><span class="token operator" style="color:#444">&amp;</span><span class="token plain">methode</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">connectedSlots</span><span class="token punctuation" style="color:#666">.</span><span class="token function" style="color:#00677c">count</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      connectedSlots</span><span class="token punctuation" style="color:#666">.</span><span class="token function" style="color:#00677c">erase</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">is_base_of</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">Object</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> OBJ_APPELE</span><span class="token operator" style="color:#444">&gt;</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">value</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      </span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Object </span><span class="token operator" style="color:#444">*</span><span class="token punctuation" style="color:#666">)</span><span class="token plain">obj_appele</span><span class="token punctuation" style="color:#666">)</span><span class="token operator" style="color:#444">-&gt;</span><span class="token function" style="color:#00677c">removeOneSignal</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">this</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token punctuation" style="color:#666">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On reconstruit un SlotKey à partir des paramètres de déconnexion, puis il ne reste plus qu&#x27;à retirer ce SlotKey du map <code>connectedSlots</code>, ce
qui peut s&#x27;exécuter très rapidement.<br>
Si l&#x27;object connecté dérive de la classe <code>Object</code> on ajoute le signal à la liste des signaux qui lui sont connnectés. Et ce une seule fois car le signal
doit apparaître dans la liste autant de fois qu&#x27;il y a de méthodes de l&#x27;objet connectées à ce signal.</p><p>On notera ici que la classe <code>Signal</code> dérive de la classe <code>SaSSignal</code>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>remarque</div><div class="admonitionContent_S0QG"><p>L&#x27;utilisateur n&#x27;a pas à se soucier de cette classe <code>SaSSignal</code>. Il devra déclarer simplement tous ses signaux en tant que <code>Signal&lt;type des paramètres...&gt;</code></p></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">class</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">SaSSignal</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token keyword" style="color:#092e64">public</span><span class="token operator" style="color:#444">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">virtual</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token function" style="color:#00677c">disconnect</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">void</span><span class="token operator" style="color:#444">*</span><span class="token plain"> obj_an</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token operator" style="color:#444">=</span><span class="token plain"> </span><span class="token number" style="color:#000080">0</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Cette classe n&#x27;a qu&#x27;une méthode <code>disconnect()</code> virtuelle pure <em>réécrite</em> (<code>override</code>) dans la classe <code>Signal</code>.</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">template</span><span class="token plain"> </span><span class="token operator" style="color:#444">&lt;</span><span class="token keyword" style="color:#092e64">typename</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">OBJ_APPELE</span><span class="token operator" style="color:#444">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token function" style="color:#00677c">disconnect</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">OBJ_APPELE </span><span class="token operator" style="color:#444">*</span><span class="token plain">obj</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">typename</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">std</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">map</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">SlotKey</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> Slot</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">Params</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token punctuation" style="color:#666">.</span><span class="token operator" style="color:#444">&gt;&gt;</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">iterator itr </span><span class="token operator" style="color:#444">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        connectedSlots</span><span class="token punctuation" style="color:#666">.</span><span class="token function" style="color:#00677c">begin</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">itr </span><span class="token operator" style="color:#444">!=</span><span class="token plain"> connectedSlots</span><span class="token punctuation" style="color:#666">.</span><span class="token function" style="color:#00677c">end</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      </span><span class="token keyword" style="color:#092e64">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">itr</span><span class="token operator" style="color:#444">-&gt;</span><span class="token plain">first</span><span class="token punctuation" style="color:#666">.</span><span class="token plain">obj_anonyme </span><span class="token operator" style="color:#444">==</span><span class="token plain"> obj</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        itr </span><span class="token operator" style="color:#444">=</span><span class="token plain"> connectedSlots</span><span class="token punctuation" style="color:#666">.</span><span class="token function" style="color:#00677c">erase</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">itr</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"> </span><span class="token keyword" style="color:#092e64">else</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        </span><span class="token operator" style="color:#444">++</span><span class="token plain">itr</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token keyword" style="color:#092e64">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">is_base_of</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">Object</span><span class="token punctuation" style="color:#666">,</span><span class="token plain"> OBJ_APPELE</span><span class="token operator" style="color:#444">&gt;</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">value</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">      </span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">Object </span><span class="token operator" style="color:#444">*</span><span class="token punctuation" style="color:#666">)</span><span class="token plain">obj</span><span class="token punctuation" style="color:#666">)</span><span class="token operator" style="color:#444">-&gt;</span><span class="token function" style="color:#00677c">removeAllSignals</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">this</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token punctuation" style="color:#666">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>L&#x27;utilisateur pourra manuellement utiliser cette fonction sur un signal pour déconnecter ce signal de toutes les méthodes de l&#x27;objet passé
en paramètre auxquelles il aurait été connecté précédemment. Cette fonction parcourt tous les clés (<code>SlotKey</code>s) du map <code>connectedSlots</code> et en retire
toute clé (et par conséquent le <code>Slot</code> associé) comprenant un objet égal à l&#x27;objet que l&#x27;on veut déconnecter.<br>
Mais cette fonction a surtout son intérêt lorsqu&#x27;elle est appelée par polymorphisme à partir de la classe <code>SaSSignal</code>. Ce qui a lieu automatiquement lorsqu&#x27;un objet
de la classe <code>Object</code> ayant été connecté à un ou plusieurs signaux est détruit. Et comme on l&#x27;a déjà fait remarquer, il est impératif de déconnecter
tous ces signaux, sans quoi, l&#x27;émission de l&#x27;un deux <strong>après</strong> la destruction de l&#x27;objet conduirait à un crash ou tout au moins à un comportement indéfini.<br>
Et ceci est fait dans le destructeur de la classe <code>Object</code> :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token class-name" style="color:#00677c">Object</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token operator" style="color:#444">~</span><span class="token function" style="color:#00677c">Object</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"> </span><span class="token function" style="color:#00677c">deleteConnectedSignals</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">Object</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token function" style="color:#00677c">deleteConnectedSignals</span><span class="token punctuation" style="color:#666">(</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token keyword" style="color:#092e64">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">(</span><span class="token plain">SaSSignal </span><span class="token operator" style="color:#444">*</span><span class="token plain">signal </span><span class="token operator" style="color:#444">:</span><span class="token plain"> connectedSignals</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">    signal</span><span class="token operator" style="color:#444">-&gt;</span><span class="token function" style="color:#00677c">disconnect</span><span class="token punctuation" style="color:#666">(</span><span class="token keyword" style="color:#092e64">this</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">  </span><span class="token punctuation" style="color:#666">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>où <code>connectSignals</code> est un vecteur de tous les signaux (<code>SaSSignal</code>s) connectés à l&#x27;objet, auquel chaque signal a été ajouté, lors de la
connexion, par la fonction <code>Object::addSignal()</code> comme vu précédemment.</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token keyword" style="color:#092e64">void</span><span class="token plain"> </span><span class="token class-name" style="color:#00677c">Object</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token function" style="color:#00677c">addSignal</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">SaSSignal</span><span class="token operator" style="color:#444">*</span><span class="token plain"> signal</span><span class="token punctuation" style="color:#666">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#666">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain">        connectedSignals</span><span class="token punctuation" style="color:#666">.</span><span class="token function" style="color:#00677c">push_back</span><span class="token punctuation" style="color:#666">(</span><span class="token plain">signal</span><span class="token punctuation" style="color:#666">)</span><span class="token punctuation" style="color:#666">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#982e64"><span class="token plain"></span><span class="token punctuation" style="color:#666">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>astuce</div><div class="admonitionContent_S0QG"><p>Pour pouvoir utiliser le polymorphisme, on utilise plus précisément des pointeurs de signaux <code>SaSSignal*</code>s :</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#982e64;--prism-background-color:#f7f7f7"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#982e64"><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#666">::</span><span class="token plain">vector</span><span class="token operator" style="color:#444">&lt;</span><span class="token plain">SaSSignal</span><span class="token operator" style="color:#444">*</span><span class="token operator" style="color:#444">&gt;</span><span class="token plain"> connectedSignals</span><span class="token punctuation" style="color:#666">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copier le code" title="Copier" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>Ce qui assurera dans le destructeur de l&#x27;objet, que l&#x27;appel <code>signal-&gt;disconnect(this);</code> se fera sur la méthode <code>disconnect()</code> de <code>Signal</code> et
non celle de <code>SaSSignal</code>.</p><p><img loading="lazy" alt="déconnexions" src="/svl-doc/assets/images/sas2-148515816f0c5023596ff38b4dfa6d21.png" width="691" height="389" class="img_ev3q"></p><p>On veillera à ce que :</p><ol><li><p>Un signal ne doit pouvoir être connecté qu&#x27;une seule fois à une même fonction/méthode. Toute autre connexion redondante doit être sans effect. Si le signal
est exécuté une fois, tout slot connecté ne doit s&#x27;exécuter qu&#x27;une seule fois.</p></li><li><p>À la connexion d&#x27;un slot : <code>signal.connect(&amp;a, &amp;A::m)</code></p><ul><li>Ne rien faire si le slot est déjà présent dans <code>connectedSlots</code></li><li>Si le slot se rattache à un objet dérivant de la classe <code>Object</code>:<ul><li>Marquer ce slot avec <code>isObject = true</code> <a href="#note_1">→ voir NOTE 1</a></li><li>Ajouter le signal à <code>connectedSignals</code> <strong>même s&#x27;il est déjà présent</strong>.</li></ul></li><li>Ajouter le slot à <code>connectedSlots</code></li></ul></li><li><p>À la déconnexion d&#x27;un slot : <code>signal.disconnect(&amp;a, &amp;A::m)</code></p><ul><li>Si le slot est bien présent dans <code>connectedSlots</code> on le retire.</li><li>On retire le signal de <code>connectedSignals</code>, <em>une seule fois</em>! (important!)</li></ul></li><li><p>Pour déconnecter un signal donné d&#x27;un objet <code>signal.disconnect(&amp;a)</code> :</p><ul><li>Pour chaque slot de <code>connectedSlots</code>: si l&#x27;objet du slot correspond à l&#x27;objet à déconnecter: supprimer le slot</li><li>Si l&#x27;objet dérive de <code>Objet</code>, parcourir les signaux de <code>connectedSignals</code>, dès le premier signal correspondant au signal à déconnecter : retirer <strong>chaque occurence</strong> de ce signal.</li></ul></li><li><p>Pour déconnecter un signal de tous ses slots <code>signal.disconnectAll()</code> :</p><ul><li>Pour chacun des slots de <code>connectedSlots</code> : Si le slot dérive de Object alors pour l&#x27;objet correspondant retirer le signal de <code>connectedSignals</code> <em>une seule fois</em>.</li><li>Purger <code>connectedSlots</code></li></ul></li><li><p>À la destruction d&#x27;un objet qui dérive de la classe Object : appliquer le point 7.</p></li><li><p>Si un objet derive de la classe Objet pour le déconnecter de tous les signaux qui lui sont connectés : <code>a.deleteConnectedSignals()</code></p><ul><li>Pour chacun des signaux dans <code>connectedSignals</code> : déconnecter l&#x27;objet du signal en appliquant 4.</li></ul></li></ol><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>attention</div><div class="admonitionContent_S0QG"><p>Un problème survient dans le cas où un signal est un membre d&#x27;une classe et qu&#x27;il est connecté à une méthode cette même classe. Observons plus bas
pourquoi et comment y remédier.</p></div></div><p>Considérons une instance d&#x27;une classe <code>Counter</code> ayant pour membre un signal <code>valueChanged</code> connecté à une méthode <code>meth_1</code> de cette même classe <code>Counter</code>.
D&#x27;autres signaux globaux ou membres d&#x27;instances d&#x27;autres classes sont connectés à certaines de ces méthodes : <code>meth_1</code> ou <code>meth_2</code>. A la destruction du Counter,
celui-ci doit informer tous les signaux qui sont connectés à lui : &quot;Je vais mourir, il ne faut plus m&#x27;appeler...!&quot;, autrement dit il doit leur demander de se déconnecter
de lui. Et cela se fait de la manière suivante :</p><ul><li><p>Le destructeur de la classe <code>Counter</code> est appelé puis celui de la classe de base <code>Object</code>.</p></li><li><p>Dans le destructeur de la classe de base <code>Object</code> la fonction <code>deleteConnectedSignals()</code> va passer en revue les pointeurs de signaux (<code>SaSSignal*</code>) et demander à chacun
d&#x27;eux de se déconnecter de lui comme décrit plus haut au point 7.</p><p><img loading="lazy" alt="destruction d&amp;#39;un Object" src="/svl-doc/assets/images/destructeurs-b5a8632df89049bb22ef59b29ba5c8be.png" width="691" height="525" class="img_ev3q"></p></li><li><p>Pour les signaux <code>1</code>, <code>2</code> et <code>3</code> il n&#x27;y a pas de problème, mais pour le signal <code>valueChanged</code> la fonction <code>deleteConnectedSignals()</code> va demander à <code>valueChanged</code> de se déconnecter.
Or le destructeur de la classe <code>Counter</code> aura déjà été effectué et donc <code>valueChanged</code> n&#x27;existe plus!! et le programme plante... Par conséquent il est indispensable de
déconnecter le signal <code>valueChanged</code> de tous les objets auxquels il est connecté (par <code>valueChanged.disconnectAll()</code>) ce qui préviendra le problème évoqué. De plus, si l&#x27;objet
connecté dérive de la classe <code>Object</code> il ne référencera plus le signal valudeChanged dans son propre conteneur <code>connectedSignals</code></p></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pagination des documents"><a class="pagination-nav__link pagination-nav__link--prev" href="/svl-doc/docs/signaux&amp;slots/Signaux"><div class="pagination-nav__sublabel">Précédent</div><div class="pagination-nav__label">Signal</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/svl-doc/docs/category/litejson"><div class="pagination-nav__sublabel">Suivant</div><div class="pagination-nav__label">liteJSON</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#quel-type-pour-représenter-un-slot-" class="table-of-contents__link toc-highlight">Quel type pour représenter un slot ?</a></li><li><a href="#anonymiser-lobjet-à-connecter" class="table-of-contents__link toc-highlight">Anonymiser l&#39;objet à connecter</a></li><li><a href="#anonymiser-la-méthode-à-connecter" class="table-of-contents__link toc-highlight">Anonymiser la méthode à connecter</a></li><li><a href="#rôle-de-la-classe-slotkey" class="table-of-contents__link toc-highlight">Rôle de la classe <code>SlotKey</code></a></li><li><a href="#construction-des-slots" class="table-of-contents__link toc-highlight">Construction des slots</a></li><li><a href="#exécution-des-slots" class="table-of-contents__link toc-highlight">Exécution des slots</a></li><li><a href="#сonnexion-dun-signal-à-une-méthode" class="table-of-contents__link toc-highlight">Сonnexion d&#39;un signal à une méthode</a></li><li><a href="#déconnexion-dun-signal" class="table-of-contents__link toc-highlight">Déconnexion d&#39;un signal</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 SavvyLite.</div></div></div></footer></div>
<script src="/svl-doc/assets/js/runtime~main.10013e08.js"></script>
<script src="/svl-doc/assets/js/main.ed95f9d1.js"></script>
</body>
</html>